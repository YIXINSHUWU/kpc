<template>
    <div>
        <Button type="primary"
            @click="set('show', true)"
        >Close Dialog Asynchronously</Button>
        <Dialog v-model="show" title="Customized ok callback"
            :ok="ok"
        >
            <Form ref="form">
                <FormItem model="code" :rules="{required: true, digits: true}" label="Code:">
                    <Input placeholder="please enter digits" v-model="code" />
                </FormItem>
            </Form>
        </Dialog>
    </div>
</template>
<script>
import Dialog from 'kpc-vue/components/dialog';
import {Form, FormItem} from 'kpc-vue/components/form';
import {Input} from 'kpc-vue/components/input';
import {Button} from 'kpc-vue/components/button';

import Message from 'kpc-vue/components/message';

export default {
    components: {
        Dialog, Form, FormItem, Input, Button
    },
    data() {
        return {
            "show": null,
            "code": null
        }
    },
    methods: {
        set(key, value) { this[key] = value },
        async ok(dialog) {
            // validate the form firstly
            const valid = await this.$refs.form.validate();
            if (valid) {
                // make the ok button show loading
                dialog.showLoading(); 
                // mock api
                new Promise((resolve, reject) => {
                    setTimeout(() => {
                        if (Math.random() > 0.5) {
                            resolve();
                        } else {
                            reject();
                        }
                    }, 2000);
                }).then(() => {
                    // if success, close dialog 
                    dialog.hideLoading();
                    dialog.close();
                }, () => {
                    // if error, don't close dialog
                    dialog.hideLoading();
                    Message.error('error occured');
                });
            }
        },
    },
}
</script>